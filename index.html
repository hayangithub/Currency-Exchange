<head>
    <title>Currency Converter</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <!-- Custom CSS -->
    <link href="loader.css" rel="stylesheet">
    <link href="styling.css" rel="stylesheet">
   
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <!-- Javascript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>

<body>

    <div class="loading hidden">
        <div class="lds-hourglass"></div>
    </div>
    
    <!-- Navigation Bar -->
    <nav class="menu navbar-default navbar-menu">
        <div class="container">
            <div class="menu-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand">Currency Converter Website</a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="#">Home</a></li>
                    <li><a href="#">Currency Converter Program</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- End of navbar-->
    <br>
    <br>
    <br>

    <div class="container">
        <div class="row">
            <div class="col-md-6 col-md-offset-3">
                <div class="panel panel-primary text-center">
                    <div class="panel-heading">
                        <h4 class="panel-title">Currency Converter</h4>
                    </div>
                    <div class="error">
                        Please enter numeric value
                    </div>
                    <div class="panel-body">
                        <form class="form-vertical">

                            <div class="form-group center">
                                <label for="">Enter Value:</label>
                                <input type="number" class="amount form-control" placeholder="Enter value" min="1">
                            </div>
                            <div class="form-group inline-block">
                                <select class="js-example-basic-single" id="first_select_list">
                                    <option value="AL">Alabama</option>
                                    <option value="WY">Wyoming</option>
                                </select>
                            </div>
                            <div class="form-group inline-block">
                                <select class="js-example-basic-single" id="second_select_list">
                                    <option value="AL">Alabama</option>
                                    <option value="WY">Wyoming</option>
                                </select>
                            </div>

                        </form>
                        <p class="results">0</p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p class="text-center">Â© HTML Template Created by Liam Docherty All Rights Reserved | Connected to Currency
                Converter API by Hayan</p>
        </div>
        </div>
    </footer>
   
    <!-- End of Footer  https://codepen.io/mackie_pl/pen/BRqKGq-->
    <!--Script-->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.js-example-basic-single').select2();
            $('#first_select_list').empty();
            $('#second_select_list').empty();
            $('#first_select_list').append('<option value=""> --Select Currency 1--</option>');
            $('#second_select_list').append('<option value=""> --Select Currency 2--</option>');

            $.getJSON('currencies.json', function (msg) {
                for (var key in msg.results) {
                    //console.log(msg.results[key]);
                    $('#first_select_list').append('<option value=' + msg.results[key].id + '>' + msg.results[key].currencyName + '(' + msg.results[key].id + ')' + '</option>');
                    $('#second_select_list').append('<option value=' + msg.results[key].id + '>' + msg.results[key].currencyName + '(' + msg.results[key].id + ')' + '</option>');
                }
            });
        });

        $("#first_select_list").change(function () {
            var selectedCurrency = $(this).children("option:selected").val();
            //alert("You have selected the country - " + selectedCurrency);
            exchangeCurrency();
        });


        $("#second_select_list").change(function () {
            var selectedCurrency = $(this).children("option:selected").val();
            //alert("You have selected the country - " + selectedCurrency);
            exchangeCurrency();
        });

        
        $(".amount").on("input", function () {
            exchangeCurrency();
        });


        function exchangeCurrency() {
            var first_currency = $('#first_select_list').children("option:selected").val();
            var second_currency = $('#second_select_list').children("option:selected").val();
            var amount = $('.amount').val();
            if (!isEmpty(first_currency) && !isEmpty(second_currency)) {

                if (first_currency == second_currency) {
                    alert("first currency should be different from second currency");
                    return;
                }

                if (isEmpty(amount)) {
                    alert("Please Insert the Amount");
                    return;
                }
                var url = 'https://free.currconv.com/api/v7/convert?q=' + first_currency + '_' + second_currency + '&compact=ultra&apiKey=6db09803905f9fc4bdb4'
                $.ajax({
                    url: url,
                    type: 'GET',
                    data: {},
                    beforeSend: function () {
                        $(".loading").removeClass('hidden');
                        $(".loading").addClass('show');
                    },
                    success: function (data) {
                        console.log(data);
                        // var obj = $.parseJSON(data);
                        var value = data[first_currency + '_' + second_currency];
                        $('.results').text(amount * value);
                    },
                    error: function (xhr, error, thrown) { // if error occured
                        console.log(xhr);
                        console.log(error);
                        alert("Error occured.please try again");
                    },
                    complete: function () {
                        $(".loading").removeClass('show');
                        $(".loading").addClass('hidden');
                    }
                });
            }
        }

        function isEmpty(property) {
            return (property === null || property === "" || typeof property === "undefined");
        }
    </script>
</body>

</html>